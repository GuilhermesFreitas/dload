#!/usr/bin/env python3

import os
import shutil
import subprocess
import sys
from pathlib import Path

if shutil.which("yt-dlp") is None:
    print("‚ùå yt-dlp n√£o encontrado! Por favor, instale com:")
    print("   ‚û§ pacman -S yt-dlp  (ou)")
    print("   ‚û§ pipx install yt-dlp")
    sys.exit(1)


def get_save_path():
    """Permite ao usu√°rio escolher entre pastas pr√©-definidas"""
    print("\n üìÇ Escolha onde salvar:")
    print("1 - Pasta Downloads")
    print("2 - Pasta Videos")
    print("3 - Pasta M√∫sicas")
    
    while True:
        choice = input("Digite o n√∫mero da op√ß√£o (1-3): ").strip()
        home = str(Path.home())
        
        if choice == "1":
            return os.path.join(home, "Downloads")
        elif choice == "2":
            videos_path = os.path.join(home, "Videos")
            Path(videos_path).mkdir(exist_ok=True)
            return videos_path
        elif choice == "3":
            music_path = os.path.join(home, "M√∫sica")
            if not os.path.exists(music_path):
                music_path = os.path.join(home, "Musicas")
            Path(music_path).mkdir(exist_ok=True)
            return music_path
        else:
            print("Op√ß√£o inv√°lida. Tente novamente.")

def baixar_audio(url, save_path):
    print("\n üì¶ Baixando √°udio (MP3)...")
    subprocess.run([
        "yt-dlp",
        "-x", "--audio-format", "mp3",
        "-o", os.path.join(save_path, "%(title)s.%(ext)s"),
        url
    ])
    print(f"\n ‚úÖ Download de √°udio conclu√≠do! Salvo em: {save_path}")

def baixar_video(url, save_path):
    print("\n üì¶ Baixando v√≠deo com √°udio (MP4)...")
    subprocess.run([
        "yt-dlp",
        "-f", "bestvideo[ext=mp4]+bestaudio[ext=m4a]/best[ext=mp4]",
        "-o", os.path.join(save_path, "%(title)s.%(ext)s"),
        url
    ])
    print(f"\n ‚úÖ Download de v√≠deo conclu√≠do! Salvo em: {save_path}")

def videoDownloader(option, url):
    save_path = get_save_path()
    print(f"\n ‚ÑπÔ∏è Os arquivos ser√£o salvos em: {save_path}")

    if option == "1":
        confirmar = input("Deseja baixar apenas o √°udio em MP3? (S/n): ").strip().lower()
        if confirmar == "s" or confirmar == "":
            baixar_audio(url, save_path)
        else:
            print("\n ‚ùå Download cancelado.")
    elif option == "2":
        confirmar = input("Deseja baixar o v√≠deo com √°udio em MP4? (S/n): ").strip().lower()
        if confirmar == "s" or confirmar == "":
            baixar_video(url, save_path)
        else:
            print("\n ‚ùå Download cancelado.")
    elif option == "3":
        print("\nüëã Saindo...")
    else:
        print("\n ‚ö†Ô∏è Op√ß√£o inv√°lida.")


print("\n" + "="*40)
print("Dload - Fastdownload".center(40))
print("="*40)
print("1 - Baixar como MP3 (M√∫sica)")
print("2 - Baixar como MP4 (V√≠deo)")
print("3 - Sair")
print("="*40)

option = input("\nEscolha uma op√ß√£o (1-3): ").strip()

if option != "3":
    url = input("\n üîó Cole aqui a URL do v√≠deo: ").strip()
    videoDownloader(option, url)
else:
    videoDownloader(option, "")
